#!/usr/bin/env bash

##############################################
#	Author: Nidia Achrys
#	Project: extract
#	Version: 1.0
#
#	Usage: extract [command] [args]
#
#	Description:
#		Extract any archive file
##############################################

version='1.0'
author='Nidia Achrys'

#######################################################################
#							                Helper Functions						            #
#######################################################################

# Replacement for 'echo'
function PRINT()
{
	if [ -z "${1}" ]; then
		printf "\n"
	else
		printf "%b\n" "${1}"
	fi
}

# Retrieve the name of the script file
function SCRIPTNAME()
{
	PRINT "${0##*/}"
}

# Pauses script execution until the user presses ENTER
function pause()
{
	read -p "Press ENTER to continue..." cmd
}

# Converts a string to all lowercase characters
function lowercase()
{
	printf "${1}" | tr "[:upper:]" "[:lower:]"
}

# Error message for when an invalid command is used
function invalid()
{
	PRINT 
	PRINT "Invalid command \"${1}\". See \"`SCRIPTNAME` help\"."
	PRINT 
}

# Error message for when no command is used
function emptycmd()
{
	PRINT 
	PRINT "You must specify a subcommand. See \"`SCRIPTNAME` help\"."
	PRINT 
}

# Checks for a filename in $PATH (commands), if not found then exit with an error
function dependency()
{
	[[ ! `command -v ${1}` ]] && PRINT "'${1}' is required to run this program." && exit 1
}

# Prints the script name and version, as well as copyright, license notice, and 
# author name
function version()
{
	PRINT "`SCRIPTNAME` v${version}"
	PRINT "Copyright (C) `date +"%Y"` ${author}"
	PRINT "License GPLv3+: GNU GPL version 3 or later <https://gnu.org/licenses/gpl.html>."
	PRINT "This is free software: you are free to change and redistribute it."
	PRINT "There is NO WARRANTY, to the extent permitted by law."
	PRINT
	PRINT "Written by ${author}."
}

#######################################################################
#								              Core Code							                  #
#######################################################################

dependency "tar"
dependency "bunzip"
dependency "unrar"
dependency "gunzip"
dependency "unzip"
dependency "uncompress"
dependency "7z"
dependency "ar"
dependency "unzstd"

if [ -f "$1" ]
then
	case "$1" in
        	*.tar.bz2)    tar xjf $1    ;;
        	*.tar.gz)     tar xzf $1    ;;
        	*.bz2)        bunzip $1     ;;
        	*.rar)        unrar x $1    ;;
        	*.gz)         gunzip $1     ;;
        	*.tar)        tar xf $1     ;;
        	*.tbz2)       tar xjf $1    ;;
        	*.tgz)        tar xzf $1    ;;
        	*.zip)        unzip $1      ;;
        	*.Z)          uncompress $1 ;;
        	*.7z)         7z x $1       ;;
        	*.deb)        ar x $1       ;;
        	*.tar.xz)     tar xf $1     ;;
        	*.tar.zst)    unzstd $1     ;;
        	*)            PRINT "'${1}' cannot be extracted via ${SCRIPTNAME}" ;;
	esac
elif [ "${1}" = "--help" ]
then
	PRINT "usage: ${SCRIPTNAME} <file>\n"
	PRINT "supported file types:"
	PRINT "tar.bz2, tar.gz, bz2, rar, gz, tar, tbz2, tgz"
	PRINT "zip, Z, 7z, deb, tar.xz, tar.zst"
elif [ -z "${1}" ]
then
	PRINT "You need to specify an archive to extract."
else
	PRINT "'${1}' is not a valid archive."
fi
